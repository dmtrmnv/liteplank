<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title data-i18n="app.title">LitePlank - –ü–ª–∞–Ω–∫–∞ —Ç—Ä–µ–∫–µ—Ä</title>
    <meta name="description" content="PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–ª–∞–Ω–∫–∏" data-i18n-content="app.description">
    <meta name="theme-color" content="#42b983">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Preload styles -->
    <link rel="preload" href="style.css?v=1.0.3" as="style">
    
    <style>
        /* –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --accent: #42b983;
            --accent-hover: #36a873;
            --danger: #dc3545;
            --warning: #ffc107;
            --border: #e9ecef;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent: #42d392;
            --accent-hover: #36c180;
            --danger: #ff6b6b;
            --warning: #ffd277;
            --border: #404040;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* –°–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ JS */
        #app { display: none; }
        .loading { display: flex; }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .notification {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 250px;
            animation: slideIn 0.3s ease-out;
            pointer-events: auto;
        }

        .notification-content {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 18px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .notification-close:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        .notification-info {
            border-left: 4px solid var(--accent);
        }

        .notification-success {
            border-left: 4px solid var(--accent);
        }

        .notification-error {
            border-left: 4px solid var(--danger);
        }

        .notification-warning {
            border-left: 4px solid var(--warning);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .notification-container {
                top: 10px;
                right: 10px;
                left: 10px;
            }
            
            .notification {
                min-width: auto;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- –≠–ª–µ–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading" class="loading" style="display: none; align-items: center; justify-content: center; height: 100vh; width: 100%;">
        <div style="text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">ü´Å</div>
            <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent);">LitePlank</div>
            <div style="color: var(--text-secondary); margin-top: 0.5rem;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="app">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav id="navbar" class="navbar">
            <div class="brand">
                <div class="brand-logo">ü´Å</div>
                <div class="brand-text">
                <div class="brand-title" data-i18n="app.brand.title">LitePlank</div>
                <div class="brand-subtitle" data-i18n="app.brand.subtitle">–ü–ª–∞–Ω–∫–∞ —Ç—Ä–µ–∫–µ—Ä</div>
                </div>
            </div>
            
            <div class="tabs" id="tabs">
                <button class="tab-btn active" data-tab="timer">
                    <span class="tab-icon">‚è±Ô∏è</span>
                    <span class="tab-text" data-i18n="tabs.timer">–¢–∞–π–º–µ—Ä</span>
                </button>
                <button class="tab-btn" data-tab="history">
                    <span class="tab-icon">üìä</span>
                    <span class="tab-text" data-i18n="tabs.history">–ò—Å—Ç–æ—Ä–∏—è</span>
                </button>
                <button class="tab-btn" data-tab="settings">
                    <span class="tab-icon">‚öôÔ∏è</span>
                    <span class="tab-text" data-i18n="tabs.settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </button>
            </div>
            
            <div class="actions">
                <button class="theme-btn" id="theme-toggle" title="–¢–µ–º–Ω–∞—è —Ç–µ–º–∞" data-i18n-title="settings.theme">
                    <span>üåô</span>
                </button>
            </div>
        </nav>

        <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é –≤–Ω–∏–∑—É -->
        <nav id="mobile-nav" class="mobile-nav">
            <div class="tabs" id="tabs">
                <button class="tab-btn active" data-tab="timer">
                    <span class="tab-icon">‚è±Ô∏è</span>
                    <span class="tab-text">–¢–∞–π–º–µ—Ä</span>
                </button>
                <button class="tab-btn" data-tab="history">
                    <span class="tab-icon">üìä</span>
                    <span class="tab-text">–ò—Å—Ç–æ—Ä–∏—è</span>
                </button>
                <button class="tab-btn" data-tab="settings">
                    <span class="tab-icon">‚öôÔ∏è</span>
                    <span class="tab-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </button>
            </div>
        </nav>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <main class="main-content">
            <!-- –¢–∞–π–º–µ—Ä -->
            <section id="timer-section" class="section active">
                <div class="timer-container">
                    <div class="timer-display">
                        <div class="time" id="timer-display">01:00</div>
                    </div>
                    
                    <div class="controls">
                        <button id="start-btn" class="btn btn-start" data-i18n="timer.start">–°—Ç–∞—Ä—Ç</button>
                        <button id="pause-btn" class="btn btn-pause" style="display: none;" data-i18n="timer.pause">–ü–∞—É–∑–∞</button>
                        <button id="finish-btn" class="btn btn-finish" style="display: none;" data-i18n="timer.finish">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                        <button id="reset-btn" class="btn btn-reset" data-i18n="timer.reset">–°–±—Ä–æ—Å</button>
                    </div>

                    <div class="settings">
                        <label>
                            <span data-i18n="timer.timeLabel">–í—Ä–µ–º—è (—Å–µ–∫):</span>
                            <input type="number" id="duration-input" value="60" min="1" max="3600">
                        </label>
                    </div>
                </div>
            </section>

            <!-- –ò—Å—Ç–æ—Ä–∏—è -->
            <section id="history-section" class="section">
                <div class="history-container">
                    <div class="history-header">
                        <h2 data-i18n="history.title">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
                        <div class="stats">
                            <div class="stat-item">
                                <span class="stat-label" data-i18n="history.totalSessions">–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫:</span>
                                <span class="stat-value" id="total-sessions">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-i18n="history.totalTime">–û–±—â–µ–µ –≤—Ä–µ–º—è:</span>
                                <span class="stat-value" id="total-time">0 <span data-i18n="units.seconds">—Å–µ–∫</span></span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-i18n="history.calories">–°–æ–∂–∂–µ–Ω–æ –∫–∞–ª–æ—Ä–∏–π:</span>
                                <span class="stat-value" id="total-calories">0 <span data-i18n="units.calories">–∫–∫–∞–ª</span></span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-i18n="history.weight">–£–¥–µ—Ä–∂–∞–Ω–æ –∫–≥:</span>
                                <span class="stat-value" id="total-weight">0 <span data-i18n="units.kilograms">–∫–≥</span></span>
                                <span class="stat-hint" title="–†–∞—Å—á–µ—Ç: –í–µ—Å √ó –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫" data-i18n-title="history.weightHint">‚ÑπÔ∏è</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-i18n="history.avgTime">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è:</span>
                                <span class="stat-value" id="avg-time">0 <span data-i18n="units.seconds">—Å–µ–∫</span></span>
                            </div>
                        </div>
                    </div>

                    <div class="history-list" id="history-list">
                        <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    </div>

                    <div class="empty-state" id="empty-state">
                        <p data-i18n="history.empty">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø—É—Å—Ç–∞</p>
                        <p class="hint" data-i18n="history.hint">–ù–∞—á–Ω–∏—Ç–µ –ø–µ—Ä–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∑–¥–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</p>
                    </div>

                    <div class="history-actions">
                        <button id="clear-history-btn" class="btn-clear" data-i18n="history.clear">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
                    </div>
                </div>
            </section>



            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <section id="settings-section" class="section">
                <div class="settings-container">
                    <div class="settings-header">
                        <h2 data-i18n="settings.title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                        <p class="subtitle" data-i18n="settings.subtitle">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</p>
                    </div>

                    <div class="settings-content">
                        <div class="settings-section">
                            <div class="section-title" data-i18n="settings.basic">‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                            
        <div class="setting-item">
            <label class="setting-label">
                <span data-i18n="settings.gender">–ü–æ–ª</span>
                <select id="userGender" class="setting-input" style="width: 120px;">
                    <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                    <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                </select>
            </label>
        </div>
        <div class="setting-item">
            <label class="setting-label">
                <span data-i18n="settings.weight">–í–µ—Å (–∫–≥)</span>
                <input type="number" id="userWeight" class="setting-input" min="30" max="200" step="0.1" value="70">
            </label>
        </div>
        <div class="setting-item">
            <label class="setting-label">
                <span data-i18n="settings.height">–†–æ—Å—Ç (—Å–º)</span>
                <input type="number" id="userHeight" class="setting-input" min="140" max="220" step="1" value="175">
            </label>
        </div>
        <div class="setting-item">
            <label class="setting-label">
                <span data-i18n="settings.age">–í–æ–∑—Ä–∞—Å—Ç</span>
                <input type="number" id="userAge" class="setting-input" min="14" max="80" step="1" value="30">
            </label>
        </div>
        <div class="setting-item">
            <button id="save-user-settings-btn" class="btn btn-primary" data-i18n="settings.save">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</button>
        </div>
        
        <!-- –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ –≤–∏–¥–∂–µ—Ç—ã -->
        <div id="notification-container" class="notification-container"></div>

                            <div class="setting-item">
                                <label class="setting-label">
                                    <span data-i18n="settings.sound">–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª</span>
                                    <input type="checkbox" id="sound-enabled" checked class="setting-checkbox">
                                </label>
                            </div>

                            <div class="setting-item">
                                <label class="setting-label">
                                    <span data-i18n="settings.vibration">–í–∏–±—Ä–∞—Ü–∏—è</span>
                                    <input type="checkbox" id="vibration-enabled" checked class="setting-checkbox">
                                </label>
                            </div>

                            <div class="setting-item">
                                <label class="setting-label">
                                    <span data-i18n="settings.language">–Ø–∑—ã–∫</span>
                                    <div id="language-selector-container">
                                        <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="section-title" data-i18n="settings.data">üíæ –î–∞–Ω–Ω—ã–µ</div>
                            
                            <div class="data-actions">
                                <button id="export-btn" class="btn-export" data-i18n="settings.export">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                                <label class="btn-import">
                                    <span data-i18n="settings.import">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</span>
                                    <input type="file" id="import-input" accept=".json" style="display: none;">
                                </label>
                            </div>

                            <div class="data-info">
                                <p>–≠–∫—Å–ø–æ—Ä—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ –≤–∞—à–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª JSON.</p>
                                <p>–ò–º–ø–æ—Ä—Ç –∑–∞–º–µ–Ω–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞.</p>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="section-title" data-i18n="settings.reset">üîß –°–±—Ä–æ—Å</div>
                            
                            <div class="reset-actions">
                                <button id="clear-all-btn" class="btn-danger" data-i18n="settings.clearAll">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                                <button id="reset-settings-btn" class="btn-warning" data-i18n="settings.resetSettings">–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                            </div>

                            <div class="reset-info">
                                <p><strong data-i18n="settings.warning">–í–Ω–∏–º–∞–Ω–∏–µ:</strong></p>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π -->
    <link rel="stylesheet" href="style.css?v=1.0.3">

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π JavaScript -->
    <script>
        // LitePlank - –ß–∏—Å—Ç—ã–π JavaScript PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        class LitePlank {
            constructor() {
                this.history = [];
                this.settings = {
                    defaultDuration: 60,
                    soundEnabled: true,
                    vibrationEnabled: true,
                    darkMode: false
                };
                this.currentSession = {
                    isRunning: false,
                    timeLeft: 0,
                    duration: 60,
                    timer: null
                };
                
                this.init();
            }

            showNotification(message, type = 'info') {
                const container = document.getElementById('notification-container');
                if (!container) return;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª—é—á–æ–º –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
                const translation = localization.getTranslation(message);
                const displayMessage = translation || message;

                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.innerHTML = `
                    <div class="notification-content">${displayMessage}</div>
                    <button class="notification-close" onclick="this.parentElement.remove()">&times;</button>
                `;

                container.appendChild(notification);

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 3000);
            }

            init() {
                this.loadSettings();
                this.loadHistory();
                this.setupEventListeners();
                this.render();
                this.setupServiceWorker();
                
                // –°–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'block';
            }

            setupEventListeners() {
                // –ù–∞–≤–∏–≥–∞—Ü–∏—è
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchTab(e.target.closest('.tab-btn').dataset.tab);
                    });
                });

                // –¢–µ–º–∞
                const themeToggle = document.getElementById('theme-toggle');
                if (themeToggle) {
                    themeToggle.addEventListener('click', () => {
                        this.toggleTheme();
                    });
                }

                // –¢–∞–π–º–µ—Ä
                const startBtn = document.getElementById('start-btn');
                const pauseBtn = document.getElementById('pause-btn');
                const finishBtn = document.getElementById('finish-btn');
                const resetBtn = document.getElementById('reset-btn');
                const durationInput = document.getElementById('duration-input');

                if (startBtn) startBtn.addEventListener('click', () => this.startTimer());
                if (pauseBtn) pauseBtn.addEventListener('click', () => this.pauseTimer());
                if (finishBtn) finishBtn.addEventListener('click', () => this.finishEarly());
                if (resetBtn) resetBtn.addEventListener('click', () => this.resetTimer());
                if (durationInput) durationInput.addEventListener('change', (e) => {
                    this.currentSession.duration = Math.max(0, parseInt(e.target.value) || 0);
                    this.currentSession.timeLeft = this.currentSession.duration;
                    this.updateTimerDisplay();
                });

                // –ò—Å—Ç–æ—Ä–∏—è
                const clearHistoryBtn = document.getElementById('clear-history-btn');
                if (clearHistoryBtn) clearHistoryBtn.addEventListener('click', () => this.clearHistory());

                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                const saveUserSettingsBtn = document.getElementById('save-user-settings-btn');
                if (saveUserSettingsBtn) saveUserSettingsBtn.addEventListener('click', () => this.saveUserSettings());
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                const userGender = document.getElementById('userGender');
                const userWeight = document.getElementById('userWeight');
                const userHeight = document.getElementById('userHeight');
                const userAge = document.getElementById('userAge');
                
                if (userGender) userGender.addEventListener('change', () => this.recalculateHistory());
                if (userWeight) userWeight.addEventListener('change', () => this.recalculateHistory());
                if (userHeight) userHeight.addEventListener('change', () => this.recalculateHistory());
                if (userAge) userAge.addEventListener('change', () => this.recalculateHistory());

                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                const defaultDuration = document.getElementById('default-duration');
                const soundEnabled = document.getElementById('sound-enabled');
                const vibrationEnabled = document.getElementById('vibration-enabled');
                const exportBtn = document.getElementById('export-btn');
                const importInput = document.getElementById('import-input');
                const clearAllBtn = document.getElementById('clear-all-btn');
                const resetSettingsBtn = document.getElementById('reset-settings-btn');

                if (defaultDuration) defaultDuration.addEventListener('change', (e) => {
                    this.settings.defaultDuration = parseInt(e.target.value);
                    this.saveSettings();
                });

                if (soundEnabled) soundEnabled.addEventListener('change', (e) => {
                    this.settings.soundEnabled = e.target.checked;
                    this.saveSettings();
                });

                if (vibrationEnabled) vibrationEnabled.addEventListener('change', (e) => {
                    this.settings.vibrationEnabled = e.target.checked;
                    this.saveSettings();
                });

                if (exportBtn) exportBtn.addEventListener('click', () => this.exportData());
                if (importInput) importInput.addEventListener('change', (e) => this.importData(e));
                if (clearAllBtn) clearAllBtn.addEventListener('click', () => this.clearAllData());
                if (resetSettingsBtn) resetSettingsBtn.addEventListener('click', () => this.resetSettings());
            }

            switchTab(tabName) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–±—ã
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.tab === tabName);
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.toggle('active', section.id === `${tabName}-section`);
                });
            }

            startTimer() {
                if (this.currentSession.timeLeft <= 0) {
                    this.currentSession.timeLeft = this.currentSession.duration;
                }
                
                this.currentSession.isRunning = true;
                this.updateTimerControls();
                
                this.currentSession.timer = setInterval(() => {
                    if (this.currentSession.timeLeft > 0) {
                        this.currentSession.timeLeft--;
                        this.updateTimerDisplay();
                    } else {
                        this.completeTimer();
                    }
                }, 1000);
            }

            pauseTimer() {
                this.currentSession.isRunning = false;
                if (this.currentSession.timer) {
                    clearInterval(this.currentSession.timer);
                    this.currentSession.timer = null;
                }
                this.updateTimerControls();
            }

            resetTimer() {
                this.pauseTimer();
                this.currentSession.timeLeft = this.currentSession.duration;
                this.updateTimerDisplay();
            }

            finishEarly() {
                this.pauseTimer();
                const actualDuration = this.currentSession.duration - this.currentSession.timeLeft;
                this.addSession(actualDuration);
                this.playSound();
                this.vibrate();
            }

            completeTimer() {
                this.pauseTimer();
                this.addSession(this.currentSession.duration);
                this.playSound();
                this.vibrate();
            }

            addSession(duration) {
                const session = {
                    date: new Date().toISOString(),
                    duration: duration,
                    calories: this.calculateCalories(duration)
                };
                this.history.unshift(session);
                this.saveHistory();
                this.updateHistory();
            }

            calculateCalories(seconds) {
    const weight = parseFloat(document.getElementById('userWeight')?.value || 70);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    if (isNaN(weight) || weight <= 0) {
        return 0;
    }
    
    // MET –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ø–ª–∞–Ω–∫–∏ (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º)
    const met = 3.5; 
    const minutes = seconds / 60;
    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: (MET * 3.5 * –≤–µ—Å –≤ –∫–≥) / 200 * –º–∏–Ω—É—Ç—ã
    const caloriesPerMinute = (met * 3.5 * weight) / 200;
    return caloriesPerMinute * minutes;
}

            playSound() {
                if (!this.settings.soundEnabled) return;
                
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –∞—É–¥–∏–æ
                }
            }

            vibrate() {
                if (!this.settings.vibrationEnabled || !navigator.vibrate) return;
                navigator.vibrate([100, 50, 100]);
            }

            updateTimerDisplay() {
                const minutes = Math.floor(this.currentSession.timeLeft / 60);
                const seconds = this.currentSession.timeLeft % 60;
                const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('timer-display').textContent = timeStr;
            }


            updateTimerControls() {
                const startBtn = document.getElementById('start-btn');
                const pauseBtn = document.getElementById('pause-btn');
                const finishBtn = document.getElementById('finish-btn');
                
                if (this.currentSession.isRunning) {
                    startBtn.style.display = 'none';
                    pauseBtn.style.display = 'inline-block';
                    finishBtn.style.display = 'inline-block';
                } else {
                    startBtn.style.display = 'inline-block';
                    pauseBtn.style.display = 'none';
                    finishBtn.style.display = 'none';
                }
            }

            updateHistory() {
                const historyList = document.getElementById('history-list');
                const emptyState = document.getElementById('empty-state');
                
                if (this.history.length === 0) {
                    historyList.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }
                
                emptyState.style.display = 'none';
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
                const recentHistory = this.history.slice(0, 10);
                historyList.innerHTML = recentHistory.map((session, index) => `
                    <div class="history-item">
                        <div class="session-info">
                            <div class="session-date">${this.formatDate(session.date)}</div>
                            <div class="session-duration">${this.formatTimeLocalized(session.duration)}</div>
                            <div class="session-calories">${session.calories.toFixed(1)} ${localization.getTranslation('units.calories') || '–∫–∫–∞–ª'}</div>
                        </div>
                        <div class="session-actions">
                            <button class="btn-delete" onclick="litePlank.deleteSession(${index})" title="–£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É" data-i18n-title="history.delete">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('');

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                this.updateHistoryStats();
                
                // –ü–µ—Ä–µ–≤–æ–¥–∏–º title –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                this.translateNewElements();
            }

            translateNewElements() {
                // –ü–µ—Ä–µ–≤–æ–¥–∏–º title –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                document.querySelectorAll('[data-i18n-title]').forEach(element => {
                    const key = element.dataset.i18nTitle;
                    const translation = localization.getTranslation(key);
                    if (translation) {
                        element.title = translation;
                    }
                });
            }

            updateHistoryStats() {
                const totalSessions = this.history.length;
                const totalTime = this.history.reduce((sum, session) => sum + session.duration, 0);
                const totalCalories = this.history.reduce((sum, session) => sum + session.calories, 0);
                const avgTime = totalSessions > 0 ? Math.round(totalTime / totalSessions) : 0;
                
                // –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userWeight = parseFloat(document.getElementById('userWeight')?.value || 70);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                if (isNaN(userWeight) || userWeight <= 0) {
                    document.getElementById('total-weight').textContent = `0 ${localization.getTranslation('units.kilograms') || '–∫–≥'}`;
                } else {
                    // –£–¥–µ—Ä–∂–∞–Ω–æ –∫–≥ = –í–µ—Å √ó –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
                    const totalWeight = userWeight * totalSessions;
                    document.getElementById('total-weight').textContent = `${totalWeight.toFixed(1)} ${localization.getTranslation('units.kilograms') || '–∫–≥'}`;
                }

                document.getElementById('total-sessions').textContent = totalSessions;
                document.getElementById('total-time').textContent = `${this.formatTotalTime(totalTime)} ${localization.getTranslation('units.seconds') || '—Å–µ–∫'}`;
                document.getElementById('total-calories').textContent = `${totalCalories.toFixed(1)} ${localization.getTranslation('units.calories') || '–∫–∫–∞–ª'}`;
                document.getElementById('avg-time').textContent = `${this.formatAverageTime(avgTime)} ${localization.getTranslation('units.seconds') || '—Å–µ–∫'}`;
            }

            deleteSession(index) {
                if (confirm(localization.getTranslation('confirmations.deleteSession') || '–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?')) {
                    this.history.splice(index, 1);
                    this.saveHistory();
                    this.updateHistory();
                    this.showNotification('notifications.success', 'success');
                }
            }

            clearHistory() {
                if (confirm(localization.getTranslation('confirmations.clearHistory') || '–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫?')) {
                    this.history = [];
                    this.saveHistory();
                    this.updateHistory();
                    this.showNotification('notifications.success', 'success');
                }
            }

            updateProgress() {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const totalSessions = this.history.length;
                const totalTime = this.history.reduce((sum, session) => sum + session.duration, 0);
                const avgTime = totalSessions > 0 ? Math.round(totalTime / totalSessions) : 0;

                document.getElementById('progress-sessions').textContent = totalSessions;
                document.getElementById('progress-total').textContent = this.formatTime(totalTime);
                document.getElementById('progress-avg').textContent = this.formatTime(avgTime);

                // –û–±–Ω–æ–≤–ª—è–µ–º –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const bestSession = this.history.length > 0 ? 
                    this.history.reduce((best, current) => current.duration > best.duration ? current : best) : null;
                
                document.getElementById('best-result').textContent = bestSession ? this.formatTime(bestSession.duration) : '0';
                document.getElementById('best-date').textContent = bestSession ? this.formatDate(bestSession.date) : '-';

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—Ä–µ–Ω–¥
                this.updateTrend();

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                this.updateRecommendations();

                // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫
                this.renderChart();
            }

            updateTrend() {
                let trend = 'neutral';
                let trendValue = 0;

                if (this.history.length >= 3) {
                    const recent = this.history.slice(-5);
                    const older = this.history.slice(-10, -5);
                    
                    if (older.length > 0) {
                        const recentAvg = recent.reduce((sum, s) => sum + s.duration, 0) / recent.length;
                        const olderAvg = older.reduce((sum, s) => sum + s.duration, 0) / older.length;
                        const diff = recentAvg - olderAvg;
                        const diffPercent = (diff / olderAvg) * 100;
                        
                        if (diffPercent > 10) trend = 'improving';
                        else if (diffPercent < -10) trend = 'declining';
                        else trend = 'stable';
                        
                        trendValue = Math.round(recentAvg);
                    }
                }

                const indicator = document.getElementById('trend-indicator');
                const value = document.getElementById('trend-value');

                indicator.className = 'trend-indicator';
                indicator.textContent = this.getTrendText(trend);
                indicator.classList.add(`trend-${trend}`);
                value.textContent = this.formatTime(trendValue);
            }

            getTrendText(trend) {
                switch (trend) {
                    case 'improving': return 'üìà –£–ª—É—á—à–∞–µ—Ç—Å—è';
                    case 'declining': return 'üìâ –°–Ω–∏–∂–∞–µ—Ç—Å—è';
                    case 'stable': return '‚û°Ô∏è –°—Ç–∞–±–∏–ª—å–Ω–æ';
                    default: return '‚ùì –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                }
            }

            updateRecommendations() {
                const container = document.getElementById('recommendations');
                
                if (this.history.length === 0) {
                    container.innerHTML = '<div class="recommendation">üéØ –ù–∞—á–Ω–∏—Ç–µ –ø–µ—Ä–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É!</div>';
                } else if (this.history.length < 5) {
                    container.innerHTML = '<div class="recommendation">üìà –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è</div>';
                } else {
                    const recent = this.history.slice(-5);
                    const older = this.history.slice(-10, -5);
                    
                    if (older.length > 0) {
                        const recentAvg = recent.reduce((sum, s) => sum + s.duration, 0) / recent.length;
                        const olderAvg = older.reduce((sum, s) => sum + s.duration, 0) / older.length;
                        const diff = recentAvg - olderAvg;
                        const diffPercent = (diff / olderAvg) * 100;
                        
                        if (diffPercent > 10) {
                            container.innerHTML = '<div class="recommendation">üöÄ –û—Ç–ª–∏—á–Ω–æ! –í—ã —É–ª—É—á—à–∞–µ—Ç–µ—Å—å!</div>';
                        } else if (diffPercent < -10) {
                            container.innerHTML = '<div class="recommendation">üîÑ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–≤–µ–ª–∏—á–∏—Ç—å –≤—Ä–µ–º—è</div>';
                        } else {
                            container.innerHTML = '<div class="recommendation">üí™ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å</div>';
                        }
                    } else {
                        container.innerHTML = '<div class="recommendation">üí™ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å</div>';
                    }
                }
            }

            renderChart() {
                const container = document.getElementById('chart-container');
                const recentSessions = this.history.slice(-10).reverse();
                
                if (recentSessions.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 2rem;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
                    return;
                }

                const maxDuration = Math.max(...recentSessions.map(s => s.duration));
                
                container.innerHTML = recentSessions.map((session, index) => `
                    <div class="chart-bar" style="height: ${(session.duration / maxDuration) * 100}%" title="${this.formatDate(session.date)}: ${this.formatTime(session.duration)}">
                        <div class="bar-label">${this.formatTime(session.duration)}</div>
                    </div>
                `).join('');
            }

            toggleTheme() {
                this.settings.darkMode = !this.settings.darkMode;
                document.documentElement.setAttribute('data-theme', this.settings.darkMode ? 'dark' : 'light');
                document.getElementById('theme-toggle').innerHTML = `<span>${this.settings.darkMode ? '‚òÄÔ∏è' : 'üåô'}</span>`;
                this.saveSettings();
            }

            exportData() {
                const data = {
                    history: this.history,
                    settings: this.settings,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `liteplank-backup-${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            importData(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.history && Array.isArray(data.history)) {
                            if (confirm(localization.getTranslation('confirmations.replaceData') || '–≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                                this.history = data.history;
                                if (data.settings) {
                                    this.settings = data.settings;
                                    this.applySettings();
                                }
                                this.saveHistory();
                                this.saveSettings();
                                this.render();
                                this.showNotification('notifications.success', 'success');
                            }
                        } else {
                            this.showNotification('notifications.error', 'error');
                        }
                    } catch (error) {
                        this.showNotification('notifications.error', 'error');
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            }

            clearAllData() {
                if (confirm(localization.getTranslation('confirmations.clearAllData') || '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                    this.history = [];
                    this.resetSettings();
                    this.saveHistory();
                    this.render();
                    this.showNotification('notifications.success', 'success');
                }
            }

            resetSettings() {
                this.settings = {
                    defaultDuration: 60,
                    soundEnabled: true,
                    vibrationEnabled: true,
                    darkMode: false
                };
                this.applySettings();
                this.saveSettings();
                this.showNotification('notifications.success', 'success');
            }

            applySettings() {
                const defaultDurationEl = document.getElementById('default-duration');
                const soundEnabledEl = document.getElementById('sound-enabled');
                const vibrationEnabledEl = document.getElementById('vibration-enabled');
                const themeToggleEl = document.getElementById('theme-toggle');
                
                if (defaultDurationEl) defaultDurationEl.value = this.settings.defaultDuration;
                if (soundEnabledEl) soundEnabledEl.checked = this.settings.soundEnabled;
                if (vibrationEnabledEl) vibrationEnabledEl.checked = this.settings.vibrationEnabled;
                document.documentElement.setAttribute('data-theme', this.settings.darkMode ? 'dark' : 'light');
                if (themeToggleEl) themeToggleEl.innerHTML = `<span>${this.settings.darkMode ? '‚òÄÔ∏è' : 'üåô'}</span>`;
            }

            saveSettings() {
                localStorage.setItem('liteplank-settings', JSON.stringify(this.settings));
            }

            loadSettings() {
                const saved = localStorage.getItem('liteplank-settings');
                if (saved) {
                    this.settings = JSON.parse(saved);
                    this.applySettings();
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                this.loadUserSettings();
            }

            saveUserSettings() {
                const userSettings = {
                    gender: document.getElementById('userGender')?.value || 'male',
                    weight: parseFloat(document.getElementById('userWeight')?.value || 70),
                    height: parseFloat(document.getElementById('userHeight')?.value || 175),
                    age: parseInt(document.getElementById('userAge')?.value || 30)
                };
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                if (isNaN(userSettings.weight) || isNaN(userSettings.height) || isNaN(userSettings.age) || 
                    userSettings.weight <= 0 || userSettings.height <= 0 || userSettings.age <= 0) {
                    this.showNotification('notifications.error', 'error');
                    return;
                }
                
                localStorage.setItem('liteplank-user-settings', JSON.stringify(userSettings));
                this.showNotification('notifications.success', 'success');
                
                // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                this.recalculateHistory();
            }

            loadUserSettings() {
                const saved = localStorage.getItem('liteplank-user-settings');
                if (saved) {
                    const userSettings = JSON.parse(saved);
                    
                    const genderEl = document.getElementById('userGender');
                    const weightEl = document.getElementById('userWeight');
                    const heightEl = document.getElementById('userHeight');
                    const ageEl = document.getElementById('userAge');
                    
                    if (genderEl) genderEl.value = userSettings.gender || 'male';
                    if (weightEl) weightEl.value = userSettings.weight || 70;
                    if (heightEl) heightEl.value = userSettings.height || 175;
                    if (ageEl) ageEl.value = userSettings.age || 30;
                }
            }

            saveHistory() {
                localStorage.setItem('liteplank-history', JSON.stringify(this.history));
            }

            loadHistory() {
                const saved = localStorage.getItem('liteplank-history');
                if (saved) {
                    this.history = JSON.parse(saved);
                }
            }

            recalculateHistory() {
                // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–∞–ª–æ—Ä–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                this.history.forEach(session => {
                    session.calories = this.calculateCalories(session.duration);
                });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
                this.saveHistory();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                this.updateHistory();
            }

            render() {
                this.currentSession.duration = this.settings.defaultDuration;
                this.currentSession.timeLeft = this.currentSession.duration;
                this.updateTimerDisplay();
                this.updateTimerControls();
                this.updateHistory();
            }

            formatTimeLocalized(seconds) {
                const unitSeconds = localization.getTranslation('units.seconds') || '—Å–µ–∫';
                const unitMinutes = localization.getTranslation('units.minutes') || '–º–∏–Ω';
                
                if (seconds < 60) return `${seconds} ${unitSeconds}`;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins} ${unitMinutes} ${secs} ${unitSeconds}`;
            }

            formatTime(seconds) {
                if (seconds < 60) return `${seconds} —Å–µ–∫`;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins} –º–∏–Ω ${secs} —Å–µ–∫`;
            }

            formatTotalTime(seconds) {
                if (seconds < 60) return `${seconds} —Å–µ–∫`;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins} –º–∏–Ω ${secs} —Å–µ–∫`;
            }

            formatAverageTime(seconds) {
                if (seconds < 60) return `${Math.round(seconds)} —Å–µ–∫`;
                const mins = Math.floor(seconds / 60);
                const secs = Math.round(seconds % 60);
                return `${mins} –º–∏–Ω ${secs} —Å–µ–∫`;
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('ru-RU', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            async setupServiceWorker() {
                if ('serviceWorker' in navigator) {
                    try {
                        const registration = await navigator.serviceWorker.register('service-worker.js');
                        console.log('SW registered');
                        
                        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Å–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä–∞
                        navigator.serviceWorker.addEventListener('message', (event) => {
                            if (event.data && event.data.type === 'UPDATE_AVAILABLE') {
                                this.handleUpdateAvailable(event.data.version);
                            }
                        });
                        
                    } catch (error) {
                        console.log('SW registration failed:', error);
                    }
                }
            }

            handleUpdateAvailable(newVersion) {
                console.log('Service Worker —Å–æ–æ–±—â–∞–µ—Ç –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:', newVersion);
                this.showNotification('notifications.success', 'success');
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            }
        }

        // –ö–ª–∞—Å—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π
        class LocalizationManager {
            constructor() {
                this.currentLang = localStorage.getItem('liteplank-lang') || 'ru';
                this.translations = {};
                this.availableLanguages = [];
                this.init();
            }

            async init() {
                await this.loadLanguagesList();
                await this.loadTranslations();
                this.updateInterface();
                this.renderLanguageSelector();
            }

            async loadLanguagesList() {
                try {
                    const response = await fetch('locales/languages.json');
                    const data = await response.json();
                    this.availableLanguages = data.languages;
                } catch (error) {
                    console.error('Error loading languages list:', error);
                    // –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ —è–∑—ã–∫–æ–≤
                    this.availableLanguages = [
                        { code: 'ru', name: '–†—É—Å—Å–∫–∏–π', englishName: 'Russian', flag: 'üá∑üá∫' },
                        { code: 'en', name: 'English', englishName: 'English', flag: 'üá∫üá∏' }
                    ];
                }
            }

            async loadTranslations() {
                try {
                    const response = await fetch(`locales/${this.currentLang}.json`);
                    this.translations = await response.json();
                } catch (error) {
                    console.error('Error loading translations:', error);
                    // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä—É—Å—Å–∫–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    try {
                        const response = await fetch('locales/ru.json');
                        this.translations = await response.json();
                        this.currentLang = 'ru';
                        localStorage.setItem('liteplank-lang', 'ru');
                    } catch (fallbackError) {
                        console.error('Cannot load any translation files');
                    }
                }
            }

            setLanguage(langCode) {
                const language = this.availableLanguages.find(l => l.code === langCode);
                if (!language) {
                    console.error('Language not found:', langCode);
                    return;
                }

                this.currentLang = langCode;
                localStorage.setItem('liteplank-lang', langCode);
                
                this.loadTranslations().then(() => {
                    this.updateInterface();
                    this.renderLanguageSelector();
                    litePlank.showNotification(
                        this.getTranslation('notifications.languageChanged') || 'Language changed successfully', 
                        'success'
                    );
                });
            }

            getTranslation(key) {
                return key.split('.').reduce((obj, prop) => obj && obj[prop], this.translations);
            }

            updateInterface() {
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-i18n
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.dataset.i18n;
                    const translation = this.getTranslation(key);
                    if (translation) {
                        element.textContent = translation;
                    }
                });

                // –û–±–Ω–æ–≤–ª—è–µ–º placeholder'—ã
                document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                    const key = element.dataset.i18nPlaceholder;
                    const translation = this.getTranslation(key);
                    if (translation) {
                        element.placeholder = translation;
                    }
                });

        // –û–±–Ω–æ–≤–ª—è–µ–º title —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                const title = this.getTranslation('app.title');
                if (title) {
                    document.title = title;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º title –∞—Ç—Ä–∏–±—É—Ç—ã
                document.querySelectorAll('[data-i18n-title]').forEach(element => {
                    const key = element.dataset.i18nTitle;
                    const translation = this.getTranslation(key);
                    if (translation) {
                        element.title = translation;
                    }
                });
            }

            renderLanguageSelector() {
                const container = document.getElementById('language-selector-container');
                if (!container) return;

                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                container.innerHTML = '';

                // –°–æ–∑–¥–∞–µ–º select
                const select = document.createElement('select');
                select.id = 'language-select';
                select.className = 'setting-input';
                select.style.width = '100%';
                select.style.maxWidth = '300px';

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ —è–∑—ã–∫–∞
                this.availableLanguages.forEach(language => {
                    const option = document.createElement('option');
                    option.value = language.code;
                    option.textContent = `${language.flag} ${language.name} (${language.englishName})`;
                    if (language.code === this.currentLang) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è
                select.addEventListener('change', (e) => {
                    this.setLanguage(e.target.value);
                });

                container.appendChild(select);
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
        const localization = new LocalizationManager();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const litePlank = new LitePlank();
    </script>
</body>

</html>


